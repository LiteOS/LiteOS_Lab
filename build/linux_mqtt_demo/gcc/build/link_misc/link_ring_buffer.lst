GAS LISTING /tmp/cceo2gJH.s 			page 1


   1              		.file	"link_ring_buffer.c"
   2              		.text
   3              	.Ltext0:
   4              		.section	.text.ring_buffer_init,"ax",@progbits
   5              		.globl	ring_buffer_init
   7              	ring_buffer_init:
   8              	.LFB0:
   9              		.file 1 "/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c"
   1:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** /*----------------------------------------------------------------------------
   2:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * Copyright (c) <2018>, <Huawei Technologies Co., Ltd>
   3:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * All rights reserved.
   4:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * Redistribution and use in source and binary forms, with or without modification,
   5:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * are permitted provided that the following conditions are met:
   6:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * 1. Redistributions of source code must retain the above copyright notice, this list of
   7:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * conditions and the following disclaimer.
   8:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * 2. Redistributions in binary form must reproduce the above copyright notice, this list
   9:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * of conditions and the following disclaimer in the documentation and/or other materials
  10:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * provided with the distribution.
  11:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * 3. Neither the name of the copyright holder nor the names of its contributors may be used
  12:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * to endorse or promote products derived from this software without specific prior written
  13:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * permission.
  14:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
  15:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  16:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  17:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR
  18:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  19:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  20:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
  21:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
  22:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
  23:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
  24:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  25:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  *---------------------------------------------------------------------------*/
  26:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** /*----------------------------------------------------------------------------
  27:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * Notice of Export Control Law
  28:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * ===============================================
  29:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * Huawei LiteOS may be subject to applicable export control laws and regulations, which might
  30:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * include those applicable to Huawei LiteOS of U.S. and the country in which you are located.
  31:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * Import, export and usage of Huawei LiteOS in any manner by you shall be in compliance with such
  32:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  * applicable export control laws and regulations.
  33:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****  *---------------------------------------------------------------------------*/
  34:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** 
  35:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** #include <stdint.h>
  36:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** #include <stddef.h>
  37:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** #include <string.h>
  38:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** 
  39:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** #include "link_misc.h"
  40:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** 
  41:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** 
  42:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** int ring_buffer_init(tag_ring_buffer_t *ring,unsigned char *buf, int buflen,int offset,int datalen)
  43:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** {
  10              		.loc 1 43 1
  11              		.cfi_startproc
  12 0000 F30F1EFA 		endbr64
  13 0004 55       		pushq	%rbp
  14              	.LCFI0:
  15              		.cfi_def_cfa_offset 16
GAS LISTING /tmp/cceo2gJH.s 			page 2


  16              		.cfi_offset 6, -16
  17 0005 4889E5   		movq	%rsp, %rbp
  18              	.LCFI1:
  19              		.cfi_def_cfa_register 6
  20 0008 4883EC30 		subq	$48, %rsp
  21 000c 48897DE8 		movq	%rdi, -24(%rbp)
  22 0010 488975E0 		movq	%rsi, -32(%rbp)
  23 0014 8955DC   		movl	%edx, -36(%rbp)
  24 0017 894DD8   		movl	%ecx, -40(%rbp)
  25 001a 448945D4 		movl	%r8d, -44(%rbp)
  26              		.loc 1 43 1
  27 001e 64488B04 		movq	%fs:40, %rax
  27      25280000 
  27      00
  28 0027 488945F8 		movq	%rax, -8(%rbp)
  29 002b 31C0     		xorl	%eax, %eax
  44:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     int ret = -1;
  30              		.loc 1 44 9
  31 002d C745F4FF 		movl	$-1, -12(%rbp)
  31      FFFFFF
  45:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     if((NULL == ring))
  32              		.loc 1 45 7
  33 0034 48837DE8 		cmpq	$0, -24(%rbp)
  33      00
  34 0039 7505     		jne	.L2
  46:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     {
  47:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         return ret;
  35              		.loc 1 47 16
  36 003b 8B45F4   		movl	-12(%rbp), %eax
  37 003e EB33     		jmp	.L3
  38              	.L2:
  48:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     }
  49:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     ring->buf     = buf;
  39              		.loc 1 49 19
  40 0040 488B45E8 		movq	-24(%rbp), %rax
  41 0044 488B55E0 		movq	-32(%rbp), %rdx
  42 0048 488910   		movq	%rdx, (%rax)
  50:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     ring->buflen  = buflen;
  43              		.loc 1 50 19
  44 004b 488B45E8 		movq	-24(%rbp), %rax
  45 004f 8B55DC   		movl	-36(%rbp), %edx
  46 0052 895008   		movl	%edx, 8(%rax)
  51:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     ring->datalen = datalen;
  47              		.loc 1 51 19
  48 0055 488B45E8 		movq	-24(%rbp), %rax
  49 0059 8B55D4   		movl	-44(%rbp), %edx
  50 005c 89500C   		movl	%edx, 12(%rax)
  52:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     ring->dataoff = offset;
  51              		.loc 1 52 19
  52 005f 488B45E8 		movq	-24(%rbp), %rax
  53 0063 8B55D8   		movl	-40(%rbp), %edx
  54 0066 895010   		movl	%edx, 16(%rax)
  53:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     ret = 0;
  55              		.loc 1 53 9
  56 0069 C745F400 		movl	$0, -12(%rbp)
  56      000000
  54:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     return ret;
GAS LISTING /tmp/cceo2gJH.s 			page 3


  57              		.loc 1 54 12
  58 0070 8B45F4   		movl	-12(%rbp), %eax
  59              	.L3:
  55:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** }
  60              		.loc 1 55 1
  61 0073 488B4DF8 		movq	-8(%rbp), %rcx
  62 0077 6448330C 		xorq	%fs:40, %rcx
  62      25280000 
  62      00
  63 0080 7405     		je	.L4
  64 0082 E8000000 		call	__stack_chk_fail@PLT
  64      00
  65              	.L4:
  66 0087 C9       		leave
  67              	.LCFI2:
  68              		.cfi_def_cfa 7, 8
  69 0088 C3       		ret
  70              		.cfi_endproc
  71              	.LFE0:
  73              		.section	.text.ring_buffer_write,"ax",@progbits
  74              		.globl	ring_buffer_write
  76              	ring_buffer_write:
  77              	.LFB1:
  56:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** 
  57:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** 
  58:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** int ring_buffer_write(tag_ring_buffer_t *ring,unsigned char *buf, int len)
  59:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** {
  78              		.loc 1 59 1
  79              		.cfi_startproc
  80 0000 F30F1EFA 		endbr64
  81 0004 55       		pushq	%rbp
  82              	.LCFI3:
  83              		.cfi_def_cfa_offset 16
  84              		.cfi_offset 6, -16
  85 0005 4889E5   		movq	%rsp, %rbp
  86              	.LCFI4:
  87              		.cfi_def_cfa_register 6
  88 0008 4883EC50 		subq	$80, %rsp
  89 000c 48897DC8 		movq	%rdi, -56(%rbp)
  90 0010 488975C0 		movq	%rsi, -64(%rbp)
  91 0014 8955BC   		movl	%edx, -68(%rbp)
  92              		.loc 1 59 1
  93 0017 64488B04 		movq	%fs:40, %rax
  93      25280000 
  93      00
  94 0020 488945F8 		movq	%rax, -8(%rbp)
  95 0024 31C0     		xorl	%eax, %eax
  60:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     int ret = -1;
  96              		.loc 1 60 9
  97 0026 C745DCFF 		movl	$-1, -36(%rbp)
  97      FFFFFF
  61:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     int cpylen;  //the current time we should move
  62:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     int lenleft;  //and how many data still left to move
  63:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     int offset;
  64:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     unsigned char *src;
  65:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     unsigned char *dst;
  66:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     if((NULL == ring)||(NULL == buf)||(0 == len))
GAS LISTING /tmp/cceo2gJH.s 			page 4


  98              		.loc 1 66 7
  99 002d 48837DC8 		cmpq	$0, -56(%rbp)
  99      00
 100 0032 740D     		je	.L6
 101              		.loc 1 66 22 discriminator 1
 102 0034 48837DC0 		cmpq	$0, -64(%rbp)
 102      00
 103 0039 7406     		je	.L6
 104              		.loc 1 66 37 discriminator 2
 105 003b 837DBC00 		cmpl	$0, -68(%rbp)
 106 003f 7508     		jne	.L7
 107              	.L6:
  67:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     {
  68:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         return ret;//which means parameters error
 108              		.loc 1 68 16
 109 0041 8B45DC   		movl	-36(%rbp), %eax
 110 0044 E9E50100 		jmp	.L8
 110      00
 111              	.L7:
  69:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     }
  70:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     if((ring->datalen == ring->buflen)|| (ring->buflen <= 0))
 112              		.loc 1 70 13
 113 0049 488B45C8 		movq	-56(%rbp), %rax
 114 004d 8B500C   		movl	12(%rax), %edx
 115              		.loc 1 70 30
 116 0050 488B45C8 		movq	-56(%rbp), %rax
 117 0054 8B4008   		movl	8(%rax), %eax
 118              		.loc 1 70 7
 119 0057 39C2     		cmpl	%eax, %edx
 120 0059 740B     		je	.L9
 121              		.loc 1 70 47 discriminator 1
 122 005b 488B45C8 		movq	-56(%rbp), %rax
 123 005f 8B4008   		movl	8(%rax), %eax
 124              		.loc 1 70 39 discriminator 1
 125 0062 85C0     		testl	%eax, %eax
 126 0064 7F0F     		jg	.L10
 127              	.L9:
  71:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     {
  72:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         ret = 0;
 128              		.loc 1 72 13
 129 0066 C745DC00 		movl	$0, -36(%rbp)
 129      000000
  73:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         return  ret;//which means you could copy nothing here
 130              		.loc 1 73 17
 131 006d 8B45DC   		movl	-36(%rbp), %eax
 132 0070 E9B90100 		jmp	.L8
 132      00
 133              	.L10:
  74:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     }
  75:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     ret = len > (ring->buflen-ring->datalen)?(ring->buflen-ring->datalen):len;
 134              		.loc 1 75 22
 135 0075 488B45C8 		movq	-56(%rbp), %rax
 136 0079 8B5008   		movl	8(%rax), %edx
 137              		.loc 1 75 35
 138 007c 488B45C8 		movq	-56(%rbp), %rax
 139 0080 8B400C   		movl	12(%rax), %eax
 140              		.loc 1 75 30
GAS LISTING /tmp/cceo2gJH.s 			page 5


 141 0083 29C2     		subl	%eax, %edx
 142 0085 89D0     		movl	%edx, %eax
 143              		.loc 1 75 9
 144 0087 3945BC   		cmpl	%eax, -68(%rbp)
 145 008a 0F4E45BC 		cmovle	-68(%rbp), %eax
 146 008e 8945DC   		movl	%eax, -36(%rbp)
  76:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     //now let us think the method to fill the data,take care of the roll back
  77:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     lenleft = ret;
 147              		.loc 1 77 13
 148 0091 8B45DC   		movl	-36(%rbp), %eax
 149 0094 8945D8   		movl	%eax, -40(%rbp)
  78:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     src = buf;
 150              		.loc 1 78 9
 151 0097 488B45C0 		movq	-64(%rbp), %rax
 152 009b 488945E8 		movq	%rax, -24(%rbp)
  79:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     if((ring->dataoff+ring->datalen)>ring->buflen) //which means the data has roll back
 153              		.loc 1 79 13
 154 009f 488B45C8 		movq	-56(%rbp), %rax
 155 00a3 8B5010   		movl	16(%rax), %edx
 156              		.loc 1 79 27
 157 00a6 488B45C8 		movq	-56(%rbp), %rax
 158 00aa 8B400C   		movl	12(%rax), %eax
 159              		.loc 1 79 22
 160 00ad 01C2     		addl	%eax, %edx
 161              		.loc 1 79 42
 162 00af 488B45C8 		movq	-56(%rbp), %rax
 163 00b3 8B4008   		movl	8(%rax), %eax
 164              		.loc 1 79 7
 165 00b6 39C2     		cmpl	%eax, %edx
 166 00b8 7E79     		jle	.L11
  80:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     {
  81:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         offset = (ring->dataoff+ring->datalen)%ring->buflen; //we could move it one time
 167              		.loc 1 81 23
 168 00ba 488B45C8 		movq	-56(%rbp), %rax
 169 00be 8B5010   		movl	16(%rax), %edx
 170              		.loc 1 81 37
 171 00c1 488B45C8 		movq	-56(%rbp), %rax
 172 00c5 8B400C   		movl	12(%rax), %eax
 173              		.loc 1 81 32
 174 00c8 01C2     		addl	%eax, %edx
 175              		.loc 1 81 52
 176 00ca 488B45C8 		movq	-56(%rbp), %rax
 177 00ce 8B4808   		movl	8(%rax), %ecx
 178              		.loc 1 81 16
 179 00d1 89D0     		movl	%edx, %eax
 180 00d3 99       		cltd
 181 00d4 F7F9     		idivl	%ecx
 182 00d6 8955E0   		movl	%edx, -32(%rbp)
  82:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         cpylen = lenleft;
 183              		.loc 1 82 16
 184 00d9 8B45D8   		movl	-40(%rbp), %eax
 185 00dc 8945E4   		movl	%eax, -28(%rbp)
  83:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         dst = ring->buf + offset;
 186              		.loc 1 83 19
 187 00df 488B45C8 		movq	-56(%rbp), %rax
 188 00e3 488B10   		movq	(%rax), %rdx
 189              		.loc 1 83 25
GAS LISTING /tmp/cceo2gJH.s 			page 6


 190 00e6 8B45E0   		movl	-32(%rbp), %eax
 191 00e9 4898     		cltq
 192              		.loc 1 83 13
 193 00eb 4801D0   		addq	%rdx, %rax
 194 00ee 488945F0 		movq	%rax, -16(%rbp)
  84:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         if(cpylen > 0)
 195              		.loc 1 84 11
 196 00f2 837DE400 		cmpl	$0, -28(%rbp)
 197 00f6 0F8EC500 		jle	.L12
 197      0000
  85:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         {
  86:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****             (void) memcpy(dst,src,cpylen);
 198              		.loc 1 86 20
 199 00fc 8B45E4   		movl	-28(%rbp), %eax
 200 00ff 4863D0   		movslq	%eax, %rdx
 201 0102 488B4DE8 		movq	-24(%rbp), %rcx
 202 0106 488B45F0 		movq	-16(%rbp), %rax
 203 010a 4889CE   		movq	%rcx, %rsi
 204 010d 4889C7   		movq	%rax, %rdi
 205 0110 E8000000 		call	memcpy@PLT
 205      00
  87:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****             ring->datalen += cpylen;
 206              		.loc 1 87 27
 207 0115 488B45C8 		movq	-56(%rbp), %rax
 208 0119 8B500C   		movl	12(%rax), %edx
 209 011c 8B45E4   		movl	-28(%rbp), %eax
 210 011f 01C2     		addl	%eax, %edx
 211 0121 488B45C8 		movq	-56(%rbp), %rax
 212 0125 89500C   		movl	%edx, 12(%rax)
  88:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****             lenleft -= cpylen;
 213              		.loc 1 88 21
 214 0128 8B45E4   		movl	-28(%rbp), %eax
 215 012b 2945D8   		subl	%eax, -40(%rbp)
 216 012e E98E0000 		jmp	.L12
 216      00
 217              	.L11:
  89:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         }
  90:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     }
  91:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     else if((ring->dataoff+ring->datalen + lenleft)>ring->buflen) //which means the data will be ro
 218              		.loc 1 91 18
 219 0133 488B45C8 		movq	-56(%rbp), %rax
 220 0137 8B5010   		movl	16(%rax), %edx
 221              		.loc 1 91 32
 222 013a 488B45C8 		movq	-56(%rbp), %rax
 223 013e 8B400C   		movl	12(%rax), %eax
 224              		.loc 1 91 27
 225 0141 01C2     		addl	%eax, %edx
 226              		.loc 1 91 42
 227 0143 8B45D8   		movl	-40(%rbp), %eax
 228 0146 01C2     		addl	%eax, %edx
 229              		.loc 1 91 57
 230 0148 488B45C8 		movq	-56(%rbp), %rax
 231 014c 8B4008   		movl	8(%rax), %eax
 232              		.loc 1 91 12
 233 014f 39C2     		cmpl	%eax, %edx
 234 0151 7E6E     		jle	.L12
  92:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     {
GAS LISTING /tmp/cceo2gJH.s 			page 7


  93:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         //which means roll back,we should copy some here to the tail
  94:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         offset = ring->dataoff + ring->datalen;
 235              		.loc 1 94 22
 236 0153 488B45C8 		movq	-56(%rbp), %rax
 237 0157 8B5010   		movl	16(%rax), %edx
 238              		.loc 1 94 38
 239 015a 488B45C8 		movq	-56(%rbp), %rax
 240 015e 8B400C   		movl	12(%rax), %eax
 241              		.loc 1 94 16
 242 0161 01D0     		addl	%edx, %eax
 243 0163 8945E0   		movl	%eax, -32(%rbp)
  95:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         cpylen = ring->buflen - offset;
 244              		.loc 1 95 22
 245 0166 488B45C8 		movq	-56(%rbp), %rax
 246 016a 8B4008   		movl	8(%rax), %eax
 247              		.loc 1 95 16
 248 016d 2B45E0   		subl	-32(%rbp), %eax
 249 0170 8945E4   		movl	%eax, -28(%rbp)
  96:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         dst = ring->buf + offset;
 250              		.loc 1 96 19
 251 0173 488B45C8 		movq	-56(%rbp), %rax
 252 0177 488B10   		movq	(%rax), %rdx
 253              		.loc 1 96 25
 254 017a 8B45E0   		movl	-32(%rbp), %eax
 255 017d 4898     		cltq
 256              		.loc 1 96 13
 257 017f 4801D0   		addq	%rdx, %rax
 258 0182 488945F0 		movq	%rax, -16(%rbp)
  97:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         (void) memcpy(dst,src,cpylen);
 259              		.loc 1 97 16
 260 0186 8B45E4   		movl	-28(%rbp), %eax
 261 0189 4863D0   		movslq	%eax, %rdx
 262 018c 488B4DE8 		movq	-24(%rbp), %rcx
 263 0190 488B45F0 		movq	-16(%rbp), %rax
 264 0194 4889CE   		movq	%rcx, %rsi
 265 0197 4889C7   		movq	%rax, %rdi
 266 019a E8000000 		call	memcpy@PLT
 266      00
  98:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         src += cpylen;
 267              		.loc 1 98 13
 268 019f 8B45E4   		movl	-28(%rbp), %eax
 269 01a2 4898     		cltq
 270 01a4 480145E8 		addq	%rax, -24(%rbp)
  99:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         ring->datalen += cpylen;
 271              		.loc 1 99 23
 272 01a8 488B45C8 		movq	-56(%rbp), %rax
 273 01ac 8B500C   		movl	12(%rax), %edx
 274 01af 8B45E4   		movl	-28(%rbp), %eax
 275 01b2 01C2     		addl	%eax, %edx
 276 01b4 488B45C8 		movq	-56(%rbp), %rax
 277 01b8 89500C   		movl	%edx, 12(%rax)
 100:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         lenleft -= cpylen;
 278              		.loc 1 100 17
 279 01bb 8B45E4   		movl	-28(%rbp), %eax
 280 01be 2945D8   		subl	%eax, -40(%rbp)
 281              	.L12:
 101:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     }
GAS LISTING /tmp/cceo2gJH.s 			page 8


 102:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     //here means we could move it by one time
 103:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     if(lenleft > 0)
 282              		.loc 1 103 7
 283 01c1 837DD800 		cmpl	$0, -40(%rbp)
 284 01c5 7E64     		jle	.L13
 104:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     {
 105:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         offset = (ring->dataoff+ring->datalen)%ring->buflen; //we could move it one time
 285              		.loc 1 105 23
 286 01c7 488B45C8 		movq	-56(%rbp), %rax
 287 01cb 8B5010   		movl	16(%rax), %edx
 288              		.loc 1 105 37
 289 01ce 488B45C8 		movq	-56(%rbp), %rax
 290 01d2 8B400C   		movl	12(%rax), %eax
 291              		.loc 1 105 32
 292 01d5 01C2     		addl	%eax, %edx
 293              		.loc 1 105 52
 294 01d7 488B45C8 		movq	-56(%rbp), %rax
 295 01db 8B4808   		movl	8(%rax), %ecx
 296              		.loc 1 105 16
 297 01de 89D0     		movl	%edx, %eax
 298 01e0 99       		cltd
 299 01e1 F7F9     		idivl	%ecx
 300 01e3 8955E0   		movl	%edx, -32(%rbp)
 106:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         cpylen = lenleft;
 301              		.loc 1 106 16
 302 01e6 8B45D8   		movl	-40(%rbp), %eax
 303 01e9 8945E4   		movl	%eax, -28(%rbp)
 107:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         dst = ring->buf + offset;
 304              		.loc 1 107 19
 305 01ec 488B45C8 		movq	-56(%rbp), %rax
 306 01f0 488B10   		movq	(%rax), %rdx
 307              		.loc 1 107 25
 308 01f3 8B45E0   		movl	-32(%rbp), %eax
 309 01f6 4898     		cltq
 310              		.loc 1 107 13
 311 01f8 4801D0   		addq	%rdx, %rax
 312 01fb 488945F0 		movq	%rax, -16(%rbp)
 108:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         (void) memcpy(dst,src,cpylen);
 313              		.loc 1 108 16
 314 01ff 8B45E4   		movl	-28(%rbp), %eax
 315 0202 4863D0   		movslq	%eax, %rdx
 316 0205 488B4DE8 		movq	-24(%rbp), %rcx
 317 0209 488B45F0 		movq	-16(%rbp), %rax
 318 020d 4889CE   		movq	%rcx, %rsi
 319 0210 4889C7   		movq	%rax, %rdi
 320 0213 E8000000 		call	memcpy@PLT
 320      00
 109:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         ring->datalen += cpylen;
 321              		.loc 1 109 23
 322 0218 488B45C8 		movq	-56(%rbp), %rax
 323 021c 8B500C   		movl	12(%rax), %edx
 324 021f 8B45E4   		movl	-28(%rbp), %eax
 325 0222 01C2     		addl	%eax, %edx
 326 0224 488B45C8 		movq	-56(%rbp), %rax
 327 0228 89500C   		movl	%edx, 12(%rax)
 328              	.L13:
 110:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     }
GAS LISTING /tmp/cceo2gJH.s 			page 9


 111:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     return ret;
 329              		.loc 1 111 12
 330 022b 8B45DC   		movl	-36(%rbp), %eax
 331              	.L8:
 112:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** }
 332              		.loc 1 112 1
 333 022e 488B75F8 		movq	-8(%rbp), %rsi
 334 0232 64483334 		xorq	%fs:40, %rsi
 334      25280000 
 334      00
 335 023b 7405     		je	.L14
 336 023d E8000000 		call	__stack_chk_fail@PLT
 336      00
 337              	.L14:
 338 0242 C9       		leave
 339              	.LCFI5:
 340              		.cfi_def_cfa 7, 8
 341 0243 C3       		ret
 342              		.cfi_endproc
 343              	.LFE1:
 345              		.section	.text.ring_buffer_read,"ax",@progbits
 346              		.globl	ring_buffer_read
 348              	ring_buffer_read:
 349              	.LFB2:
 113:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** 
 114:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** 
 115:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** int ring_buffer_read(tag_ring_buffer_t *ring,unsigned char *buf, int len)
 116:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** {
 350              		.loc 1 116 1
 351              		.cfi_startproc
 352 0000 F30F1EFA 		endbr64
 353 0004 55       		pushq	%rbp
 354              	.LCFI6:
 355              		.cfi_def_cfa_offset 16
 356              		.cfi_offset 6, -16
 357 0005 4889E5   		movq	%rsp, %rbp
 358              	.LCFI7:
 359              		.cfi_def_cfa_register 6
 360 0008 4883EC50 		subq	$80, %rsp
 361 000c 48897DC8 		movq	%rdi, -56(%rbp)
 362 0010 488975C0 		movq	%rsi, -64(%rbp)
 363 0014 8955BC   		movl	%edx, -68(%rbp)
 364              		.loc 1 116 1
 365 0017 64488B04 		movq	%fs:40, %rax
 365      25280000 
 365      00
 366 0020 488945F8 		movq	%rax, -8(%rbp)
 367 0024 31C0     		xorl	%eax, %eax
 117:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     int ret = -1;
 368              		.loc 1 117 9
 369 0026 C745DCFF 		movl	$-1, -36(%rbp)
 369      FFFFFF
 118:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     int cpylen;  //the current time we should move
 119:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     int lenleft;  //and how many data still left to move
 120:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     int offset;
 121:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     unsigned char *src;
 122:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     unsigned char *dst;
GAS LISTING /tmp/cceo2gJH.s 			page 10


 123:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     if((NULL == ring)||(NULL == buf)||(0 == len))
 370              		.loc 1 123 7
 371 002d 48837DC8 		cmpq	$0, -56(%rbp)
 371      00
 372 0032 740D     		je	.L16
 373              		.loc 1 123 22 discriminator 1
 374 0034 48837DC0 		cmpq	$0, -64(%rbp)
 374      00
 375 0039 7406     		je	.L16
 376              		.loc 1 123 37 discriminator 2
 377 003b 837DBC00 		cmpl	$0, -68(%rbp)
 378 003f 7508     		jne	.L17
 379              	.L16:
 124:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     {
 125:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         return ret;//which means parameters error
 380              		.loc 1 125 16
 381 0041 8B45DC   		movl	-36(%rbp), %eax
 382 0044 E95A0100 		jmp	.L18
 382      00
 383              	.L17:
 126:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     }
 127:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     if((ring->datalen == 0) || (ring->buflen <= 0))
 384              		.loc 1 127 13
 385 0049 488B45C8 		movq	-56(%rbp), %rax
 386 004d 8B400C   		movl	12(%rax), %eax
 387              		.loc 1 127 7
 388 0050 85C0     		testl	%eax, %eax
 389 0052 740B     		je	.L19
 390              		.loc 1 127 37 discriminator 1
 391 0054 488B45C8 		movq	-56(%rbp), %rax
 392 0058 8B4008   		movl	8(%rax), %eax
 393              		.loc 1 127 29 discriminator 1
 394 005b 85C0     		testl	%eax, %eax
 395 005d 7F0F     		jg	.L20
 396              	.L19:
 128:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     {
 129:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         ret = 0;
 397              		.loc 1 129 13
 398 005f C745DC00 		movl	$0, -36(%rbp)
 398      000000
 130:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         return  ret;//which means you could copy nothing here
 399              		.loc 1 130 17
 400 0066 8B45DC   		movl	-36(%rbp), %eax
 401 0069 E9350100 		jmp	.L18
 401      00
 402              	.L20:
 131:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     }
 132:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     ret = len > ring->datalen?ring->datalen:len;
 403              		.loc 1 132 21
 404 006e 488B45C8 		movq	-56(%rbp), %rax
 405 0072 8B400C   		movl	12(%rax), %eax
 406              		.loc 1 132 9
 407 0075 3945BC   		cmpl	%eax, -68(%rbp)
 408 0078 0F4E45BC 		cmovle	-68(%rbp), %eax
 409 007c 8945DC   		movl	%eax, -36(%rbp)
 133:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     //now let us think the method to fill the data,take care of the roll back
 134:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     lenleft = ret;
GAS LISTING /tmp/cceo2gJH.s 			page 11


 410              		.loc 1 134 13
 411 007f 8B45DC   		movl	-36(%rbp), %eax
 412 0082 8945D8   		movl	%eax, -40(%rbp)
 135:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     dst = buf;
 413              		.loc 1 135 9
 414 0085 488B45C0 		movq	-64(%rbp), %rax
 415 0089 488945E8 		movq	%rax, -24(%rbp)
 136:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     if(ring->dataoff >= (ring->buflen - lenleft)) //which means the data has roll back
 416              		.loc 1 136 12
 417 008d 488B45C8 		movq	-56(%rbp), %rax
 418 0091 8B5010   		movl	16(%rax), %edx
 419              		.loc 1 136 30
 420 0094 488B45C8 		movq	-56(%rbp), %rax
 421 0098 8B4008   		movl	8(%rax), %eax
 422              		.loc 1 136 39
 423 009b 2B45D8   		subl	-40(%rbp), %eax
 424              		.loc 1 136 7
 425 009e 39C2     		cmpl	%eax, %edx
 426 00a0 0F8C9200 		jl	.L21
 426      0000
 137:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     {
 138:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         offset =ring->dataoff; //we cpy part
 427              		.loc 1 138 16
 428 00a6 488B45C8 		movq	-56(%rbp), %rax
 429 00aa 8B4010   		movl	16(%rax), %eax
 430 00ad 8945E0   		movl	%eax, -32(%rbp)
 139:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         cpylen = ring->buflen - ring->dataoff;
 431              		.loc 1 139 22
 432 00b0 488B45C8 		movq	-56(%rbp), %rax
 433 00b4 8B5008   		movl	8(%rax), %edx
 434              		.loc 1 139 37
 435 00b7 488B45C8 		movq	-56(%rbp), %rax
 436 00bb 8B4010   		movl	16(%rax), %eax
 437              		.loc 1 139 16
 438 00be 29C2     		subl	%eax, %edx
 439 00c0 89D0     		movl	%edx, %eax
 440 00c2 8945E4   		movl	%eax, -28(%rbp)
 140:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         src = ring->buf + offset;
 441              		.loc 1 140 19
 442 00c5 488B45C8 		movq	-56(%rbp), %rax
 443 00c9 488B10   		movq	(%rax), %rdx
 444              		.loc 1 140 25
 445 00cc 8B45E0   		movl	-32(%rbp), %eax
 446 00cf 4898     		cltq
 447              		.loc 1 140 13
 448 00d1 4801D0   		addq	%rdx, %rax
 449 00d4 488945F0 		movq	%rax, -16(%rbp)
 141:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** 
 142:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         if(cpylen > 0)
 450              		.loc 1 142 11
 451 00d8 837DE400 		cmpl	$0, -28(%rbp)
 452 00dc 7E5A     		jle	.L21
 143:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         {
 144:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****             (void) memcpy(dst,src,cpylen);
 453              		.loc 1 144 20
 454 00de 8B45E4   		movl	-28(%rbp), %eax
 455 00e1 4863D0   		movslq	%eax, %rdx
GAS LISTING /tmp/cceo2gJH.s 			page 12


 456 00e4 488B4DF0 		movq	-16(%rbp), %rcx
 457 00e8 488B45E8 		movq	-24(%rbp), %rax
 458 00ec 4889CE   		movq	%rcx, %rsi
 459 00ef 4889C7   		movq	%rax, %rdi
 460 00f2 E8000000 		call	memcpy@PLT
 460      00
 145:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****             ring->dataoff = (ring->dataoff + cpylen)%ring->buflen;
 461              		.loc 1 145 34
 462 00f7 488B45C8 		movq	-56(%rbp), %rax
 463 00fb 8B5010   		movl	16(%rax), %edx
 464              		.loc 1 145 44
 465 00fe 8B45E4   		movl	-28(%rbp), %eax
 466 0101 01C2     		addl	%eax, %edx
 467              		.loc 1 145 58
 468 0103 488B45C8 		movq	-56(%rbp), %rax
 469 0107 8B4808   		movl	8(%rax), %ecx
 470              		.loc 1 145 53
 471 010a 89D0     		movl	%edx, %eax
 472 010c 99       		cltd
 473 010d F7F9     		idivl	%ecx
 474              		.loc 1 145 27
 475 010f 488B45C8 		movq	-56(%rbp), %rax
 476 0113 895010   		movl	%edx, 16(%rax)
 146:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****             ring->datalen -= cpylen;
 477              		.loc 1 146 27
 478 0116 488B45C8 		movq	-56(%rbp), %rax
 479 011a 8B400C   		movl	12(%rax), %eax
 480 011d 2B45E4   		subl	-28(%rbp), %eax
 481 0120 89C2     		movl	%eax, %edx
 482 0122 488B45C8 		movq	-56(%rbp), %rax
 483 0126 89500C   		movl	%edx, 12(%rax)
 147:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****             lenleft -= cpylen;
 484              		.loc 1 147 21
 485 0129 8B45E4   		movl	-28(%rbp), %eax
 486 012c 2945D8   		subl	%eax, -40(%rbp)
 148:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****             dst += cpylen;
 487              		.loc 1 148 17
 488 012f 8B45E4   		movl	-28(%rbp), %eax
 489 0132 4898     		cltq
 490 0134 480145E8 		addq	%rax, -24(%rbp)
 491              	.L21:
 149:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         }
 150:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     }
 151:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     //here means we could move it by one time
 152:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     if(lenleft > 0)
 492              		.loc 1 152 7
 493 0138 837DD800 		cmpl	$0, -40(%rbp)
 494 013c 7E62     		jle	.L22
 153:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     {
 154:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         offset =ring->dataoff; //we cpy part
 495              		.loc 1 154 16
 496 013e 488B45C8 		movq	-56(%rbp), %rax
 497 0142 8B4010   		movl	16(%rax), %eax
 498 0145 8945E0   		movl	%eax, -32(%rbp)
 155:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         cpylen = lenleft;
 499              		.loc 1 155 16
 500 0148 8B45D8   		movl	-40(%rbp), %eax
GAS LISTING /tmp/cceo2gJH.s 			page 13


 501 014b 8945E4   		movl	%eax, -28(%rbp)
 156:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         src = ring->buf + offset;
 502              		.loc 1 156 19
 503 014e 488B45C8 		movq	-56(%rbp), %rax
 504 0152 488B10   		movq	(%rax), %rdx
 505              		.loc 1 156 25
 506 0155 8B45E0   		movl	-32(%rbp), %eax
 507 0158 4898     		cltq
 508              		.loc 1 156 13
 509 015a 4801D0   		addq	%rdx, %rax
 510 015d 488945F0 		movq	%rax, -16(%rbp)
 157:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         (void) memcpy(dst,src,cpylen);
 511              		.loc 1 157 16
 512 0161 8B45E4   		movl	-28(%rbp), %eax
 513 0164 4863D0   		movslq	%eax, %rdx
 514 0167 488B4DF0 		movq	-16(%rbp), %rcx
 515 016b 488B45E8 		movq	-24(%rbp), %rax
 516 016f 4889CE   		movq	%rcx, %rsi
 517 0172 4889C7   		movq	%rax, %rdi
 518 0175 E8000000 		call	memcpy@PLT
 518      00
 158:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         ring->dataoff = ring->dataoff + cpylen;
 519              		.loc 1 158 29
 520 017a 488B45C8 		movq	-56(%rbp), %rax
 521 017e 8B5010   		movl	16(%rax), %edx
 522              		.loc 1 158 39
 523 0181 8B45E4   		movl	-28(%rbp), %eax
 524 0184 01C2     		addl	%eax, %edx
 525              		.loc 1 158 23
 526 0186 488B45C8 		movq	-56(%rbp), %rax
 527 018a 895010   		movl	%edx, 16(%rax)
 159:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         ring->datalen -= cpylen;
 528              		.loc 1 159 23
 529 018d 488B45C8 		movq	-56(%rbp), %rax
 530 0191 8B400C   		movl	12(%rax), %eax
 531 0194 2B45E4   		subl	-28(%rbp), %eax
 532 0197 89C2     		movl	%eax, %edx
 533 0199 488B45C8 		movq	-56(%rbp), %rax
 534 019d 89500C   		movl	%edx, 12(%rax)
 535              	.L22:
 160:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     }
 161:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     return ret;
 536              		.loc 1 161 12
 537 01a0 8B45DC   		movl	-36(%rbp), %eax
 538              	.L18:
 162:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** }
 539              		.loc 1 162 1
 540 01a3 488B75F8 		movq	-8(%rbp), %rsi
 541 01a7 64483334 		xorq	%fs:40, %rsi
 541      25280000 
 541      00
 542 01b0 7405     		je	.L23
 543 01b2 E8000000 		call	__stack_chk_fail@PLT
 543      00
 544              	.L23:
 545 01b7 C9       		leave
 546              	.LCFI8:
GAS LISTING /tmp/cceo2gJH.s 			page 14


 547              		.cfi_def_cfa 7, 8
 548 01b8 C3       		ret
 549              		.cfi_endproc
 550              	.LFE2:
 552              		.section	.text.ring_buffer_datalen,"ax",@progbits
 553              		.globl	ring_buffer_datalen
 555              	ring_buffer_datalen:
 556              	.LFB3:
 163:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** 
 164:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** 
 165:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** int ring_buffer_datalen(tag_ring_buffer_t *ring)
 166:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** {
 557              		.loc 1 166 1
 558              		.cfi_startproc
 559 0000 F30F1EFA 		endbr64
 560 0004 55       		pushq	%rbp
 561              	.LCFI9:
 562              		.cfi_def_cfa_offset 16
 563              		.cfi_offset 6, -16
 564 0005 4889E5   		movq	%rsp, %rbp
 565              	.LCFI10:
 566              		.cfi_def_cfa_register 6
 567 0008 4883EC20 		subq	$32, %rsp
 568 000c 48897DE8 		movq	%rdi, -24(%rbp)
 569              		.loc 1 166 1
 570 0010 64488B04 		movq	%fs:40, %rax
 570      25280000 
 570      00
 571 0019 488945F8 		movq	%rax, -8(%rbp)
 572 001d 31C0     		xorl	%eax, %eax
 167:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     int ret = -1;
 573              		.loc 1 167 9
 574 001f C745F4FF 		movl	$-1, -12(%rbp)
 574      FFFFFF
 168:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     if(NULL != ring)
 575              		.loc 1 168 7
 576 0026 48837DE8 		cmpq	$0, -24(%rbp)
 576      00
 577 002b 740A     		je	.L25
 169:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     {
 170:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         ret = ring->datalen;
 578              		.loc 1 170 13
 579 002d 488B45E8 		movq	-24(%rbp), %rax
 580 0031 8B400C   		movl	12(%rax), %eax
 581 0034 8945F4   		movl	%eax, -12(%rbp)
 582              	.L25:
 171:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     }
 172:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     return ret;
 583              		.loc 1 172 12
 584 0037 8B45F4   		movl	-12(%rbp), %eax
 173:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** }
 585              		.loc 1 173 1
 586 003a 488B55F8 		movq	-8(%rbp), %rdx
 587 003e 64483314 		xorq	%fs:40, %rdx
 587      25280000 
 587      00
 588 0047 7405     		je	.L27
GAS LISTING /tmp/cceo2gJH.s 			page 15


 589 0049 E8000000 		call	__stack_chk_fail@PLT
 589      00
 590              	.L27:
 591 004e C9       		leave
 592              	.LCFI11:
 593              		.cfi_def_cfa 7, 8
 594 004f C3       		ret
 595              		.cfi_endproc
 596              	.LFE3:
 598              		.section	.text.ring_buffer_freespace,"ax",@progbits
 599              		.globl	ring_buffer_freespace
 601              	ring_buffer_freespace:
 602              	.LFB4:
 174:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** 
 175:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** int ring_buffer_freespace(tag_ring_buffer_t *ring)
 176:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** {
 603              		.loc 1 176 1
 604              		.cfi_startproc
 605 0000 F30F1EFA 		endbr64
 606 0004 55       		pushq	%rbp
 607              	.LCFI12:
 608              		.cfi_def_cfa_offset 16
 609              		.cfi_offset 6, -16
 610 0005 4889E5   		movq	%rsp, %rbp
 611              	.LCFI13:
 612              		.cfi_def_cfa_register 6
 613 0008 4883EC20 		subq	$32, %rsp
 614 000c 48897DE8 		movq	%rdi, -24(%rbp)
 615              		.loc 1 176 1
 616 0010 64488B04 		movq	%fs:40, %rax
 616      25280000 
 616      00
 617 0019 488945F8 		movq	%rax, -8(%rbp)
 618 001d 31C0     		xorl	%eax, %eax
 177:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     int ret = -1;
 619              		.loc 1 177 9
 620 001f C745F4FF 		movl	$-1, -12(%rbp)
 620      FFFFFF
 178:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     if(NULL != ring)
 621              		.loc 1 178 7
 622 0026 48837DE8 		cmpq	$0, -24(%rbp)
 622      00
 623 002b 7415     		je	.L29
 179:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     {
 180:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         ret = ring->buflen-ring->datalen;
 624              		.loc 1 180 19
 625 002d 488B45E8 		movq	-24(%rbp), %rax
 626 0031 8B5008   		movl	8(%rax), %edx
 627              		.loc 1 180 32
 628 0034 488B45E8 		movq	-24(%rbp), %rax
 629 0038 8B400C   		movl	12(%rax), %eax
 630              		.loc 1 180 13
 631 003b 29C2     		subl	%eax, %edx
 632 003d 89D0     		movl	%edx, %eax
 633 003f 8945F4   		movl	%eax, -12(%rbp)
 634              	.L29:
 181:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     }
GAS LISTING /tmp/cceo2gJH.s 			page 16


 182:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     return ret;
 635              		.loc 1 182 12
 636 0042 8B45F4   		movl	-12(%rbp), %eax
 183:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** }
 637              		.loc 1 183 1
 638 0045 488B4DF8 		movq	-8(%rbp), %rcx
 639 0049 6448330C 		xorq	%fs:40, %rcx
 639      25280000 
 639      00
 640 0052 7405     		je	.L31
 641 0054 E8000000 		call	__stack_chk_fail@PLT
 641      00
 642              	.L31:
 643 0059 C9       		leave
 644              	.LCFI14:
 645              		.cfi_def_cfa 7, 8
 646 005a C3       		ret
 647              		.cfi_endproc
 648              	.LFE4:
 650              		.section	.text.ring_buffer_reset,"ax",@progbits
 651              		.globl	ring_buffer_reset
 653              	ring_buffer_reset:
 654              	.LFB5:
 184:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** 
 185:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** int ring_buffer_reset(tag_ring_buffer_t *ring)
 186:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** {
 655              		.loc 1 186 1
 656              		.cfi_startproc
 657 0000 F30F1EFA 		endbr64
 658 0004 55       		pushq	%rbp
 659              	.LCFI15:
 660              		.cfi_def_cfa_offset 16
 661              		.cfi_offset 6, -16
 662 0005 4889E5   		movq	%rsp, %rbp
 663              	.LCFI16:
 664              		.cfi_def_cfa_register 6
 665 0008 4883EC20 		subq	$32, %rsp
 666 000c 48897DE8 		movq	%rdi, -24(%rbp)
 667              		.loc 1 186 1
 668 0010 64488B04 		movq	%fs:40, %rax
 668      25280000 
 668      00
 669 0019 488945F8 		movq	%rax, -8(%rbp)
 670 001d 31C0     		xorl	%eax, %eax
 187:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     int ret = -1;
 671              		.loc 1 187 9
 672 001f C745F4FF 		movl	$-1, -12(%rbp)
 672      FFFFFF
 188:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     if(NULL != ring)
 673              		.loc 1 188 7
 674 0026 48837DE8 		cmpq	$0, -24(%rbp)
 674      00
 675 002b 741D     		je	.L33
 189:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     {
 190:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         ring->datalen = 0;
 676              		.loc 1 190 23
 677 002d 488B45E8 		movq	-24(%rbp), %rax
GAS LISTING /tmp/cceo2gJH.s 			page 17


 678 0031 C7400C00 		movl	$0, 12(%rax)
 678      000000
 191:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         ring->dataoff = 0;
 679              		.loc 1 191 23
 680 0038 488B45E8 		movq	-24(%rbp), %rax
 681 003c C7401000 		movl	$0, 16(%rax)
 681      000000
 192:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         ret = 0;
 682              		.loc 1 192 13
 683 0043 C745F400 		movl	$0, -12(%rbp)
 683      000000
 684              	.L33:
 193:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     }
 194:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     return ret;
 685              		.loc 1 194 12
 686 004a 8B45F4   		movl	-12(%rbp), %eax
 195:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** }
 687              		.loc 1 195 1
 688 004d 488B55F8 		movq	-8(%rbp), %rdx
 689 0051 64483314 		xorq	%fs:40, %rdx
 689      25280000 
 689      00
 690 005a 7405     		je	.L35
 691 005c E8000000 		call	__stack_chk_fail@PLT
 691      00
 692              	.L35:
 693 0061 C9       		leave
 694              	.LCFI17:
 695              		.cfi_def_cfa 7, 8
 696 0062 C3       		ret
 697              		.cfi_endproc
 698              	.LFE5:
 700              		.section	.text.ring_buffer_deinit,"ax",@progbits
 701              		.globl	ring_buffer_deinit
 703              	ring_buffer_deinit:
 704              	.LFB6:
 196:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** 
 197:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** int ring_buffer_deinit(tag_ring_buffer_t *ring)
 198:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** {
 705              		.loc 1 198 1
 706              		.cfi_startproc
 707 0000 F30F1EFA 		endbr64
 708 0004 55       		pushq	%rbp
 709              	.LCFI18:
 710              		.cfi_def_cfa_offset 16
 711              		.cfi_offset 6, -16
 712 0005 4889E5   		movq	%rsp, %rbp
 713              	.LCFI19:
 714              		.cfi_def_cfa_register 6
 715 0008 4883EC20 		subq	$32, %rsp
 716 000c 48897DE8 		movq	%rdi, -24(%rbp)
 717              		.loc 1 198 1
 718 0010 64488B04 		movq	%fs:40, %rax
 718      25280000 
 718      00
 719 0019 488945F8 		movq	%rax, -8(%rbp)
 720 001d 31C0     		xorl	%eax, %eax
GAS LISTING /tmp/cceo2gJH.s 			page 18


 199:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     int ret = -1;
 721              		.loc 1 199 9
 722 001f C745F4FF 		movl	$-1, -12(%rbp)
 722      FFFFFF
 200:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     if(NULL != ring)
 723              		.loc 1 200 7
 724 0026 48837DE8 		cmpq	$0, -24(%rbp)
 724      00
 725 002b 741D     		je	.L37
 201:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     {
 202:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         (void) memset(ring,0,sizeof(tag_ring_buffer_t));
 726              		.loc 1 202 16
 727 002d 488B45E8 		movq	-24(%rbp), %rax
 728 0031 BA180000 		movl	$24, %edx
 728      00
 729 0036 BE000000 		movl	$0, %esi
 729      00
 730 003b 4889C7   		movq	%rax, %rdi
 731 003e E8000000 		call	memset@PLT
 731      00
 203:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****         ret = 0;
 732              		.loc 1 203 13
 733 0043 C745F400 		movl	$0, -12(%rbp)
 733      000000
 734              	.L37:
 204:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     }
 205:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c ****     return ret;
 735              		.loc 1 205 12
 736 004a 8B45F4   		movl	-12(%rbp), %eax
 206:/home/xingli/share/1205tiny/link_misc/link_ring_buffer.c **** }
 737              		.loc 1 206 1
 738 004d 488B4DF8 		movq	-8(%rbp), %rcx
 739 0051 6448330C 		xorq	%fs:40, %rcx
 739      25280000 
 739      00
 740 005a 7405     		je	.L39
 741 005c E8000000 		call	__stack_chk_fail@PLT
 741      00
 742              	.L39:
 743 0061 C9       		leave
 744              	.LCFI20:
 745              		.cfi_def_cfa 7, 8
 746 0062 C3       		ret
 747              		.cfi_endproc
 748              	.LFE6:
 750              		.text
 751              	.Letext0:
 752              		.file 2 "/home/xingli/share/1205tiny/link_misc/link_misc.h"
 1762              		.section	.note.gnu.property,"a"
 1763              		.align 8
 1764 0000 04000000 		.long	 1f - 0f
 1765 0004 10000000 		.long	 4f - 1f
 1766 0008 05000000 		.long	 5
 1767              	0:
 1768 000c 474E5500 		.string	 "GNU"
 1769              	1:
 1770              		.align 8
GAS LISTING /tmp/cceo2gJH.s 			page 19


 1771 0010 020000C0 		.long	 0xc0000002
 1772 0014 04000000 		.long	 3f - 2f
 1773              	2:
 1774 0018 03000000 		.long	 0x3
 1775              	3:
 1776 001c 00000000 		.align 8
 1777              	4:
GAS LISTING /tmp/cceo2gJH.s 			page 20


DEFINED SYMBOLS
                            *ABS*:0000000000000000 link_ring_buffer.c
     /tmp/cceo2gJH.s:7      .text.ring_buffer_init:0000000000000000 ring_buffer_init
     /tmp/cceo2gJH.s:76     .text.ring_buffer_write:0000000000000000 ring_buffer_write
     /tmp/cceo2gJH.s:348    .text.ring_buffer_read:0000000000000000 ring_buffer_read
     /tmp/cceo2gJH.s:555    .text.ring_buffer_datalen:0000000000000000 ring_buffer_datalen
     /tmp/cceo2gJH.s:601    .text.ring_buffer_freespace:0000000000000000 ring_buffer_freespace
     /tmp/cceo2gJH.s:653    .text.ring_buffer_reset:0000000000000000 ring_buffer_reset
     /tmp/cceo2gJH.s:703    .text.ring_buffer_deinit:0000000000000000 ring_buffer_deinit

UNDEFINED SYMBOLS
_GLOBAL_OFFSET_TABLE_
__stack_chk_fail
memcpy
memset
