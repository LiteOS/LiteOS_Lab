GAS LISTING /tmp/ccFibjQv.s 			page 1


   1              		.file	"gets_s.c"
   2              		.text
   3              	.Ltext0:
   4              		.section	.text.SecTrimCRLF,"ax",@progbits
   6              	SecTrimCRLF:
   7              	.LFB6:
   8              		.file 1 "/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c"
   1:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c **** /*
   2:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  * Copyright (c) [2019] Huawei Technologies Co.,Ltd.All rights reserved.
   3:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  *
   4:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  * OpenArkCompiler is licensed under the Mulan PSL v1. 
   5:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  * You can use this software according to the terms and conditions of the Mulan PSL v1.
   6:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  * You may obtain a copy of Mulan PSL v1 at:
   7:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  *
   8:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  * 	http://license.coscl.org.cn/MulanPSL 
   9:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  *
  10:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  * THIS SOFTWARE IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OF ANY KIND, EITHER 
  11:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT, MERCHANTABILITY OR
  12:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  * FIT FOR A PARTICULAR PURPOSE.  
  13:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  * See the Mulan PSL v1 for more details.  
  14:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  */
  15:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c **** 
  16:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c **** #include "securecutil.h"
  17:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c **** 
  18:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c **** static void SecTrimCRLF(char *buffer, size_t len)
  19:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c **** {
   9              		.loc 1 19 1
  10              		.cfi_startproc
  11 0000 F30F1EFA 		endbr64
  12 0004 55       		pushq	%rbp
  13              	.LCFI0:
  14              		.cfi_def_cfa_offset 16
  15              		.cfi_offset 6, -16
  16 0005 4889E5   		movq	%rsp, %rbp
  17              	.LCFI1:
  18              		.cfi_def_cfa_register 6
  19 0008 4883EC20 		subq	$32, %rsp
  20 000c 48897DE8 		movq	%rdi, -24(%rbp)
  21 0010 488975E0 		movq	%rsi, -32(%rbp)
  22              		.loc 1 19 1
  23 0014 64488B04 		movq	%fs:40, %rax
  23      25280000 
  23      00
  24 001d 488945F8 		movq	%rax, -8(%rbp)
  25 0021 31C0     		xorl	%eax, %eax
  20:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****     int i;
  21:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****     /* No need to determine whether integer overflow exists */
  22:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****     for (i = (int)(len - 1); i >= 0 && (buffer[i] == '\r' || buffer[i] == '\n'); --i) {
  26              		.loc 1 22 24
  27 0023 488B45E0 		movq	-32(%rbp), %rax
  28 0027 83E801   		subl	$1, %eax
  29              		.loc 1 22 12
  30 002a 8945F4   		movl	%eax, -12(%rbp)
  31              		.loc 1 22 5
  32 002d EB14     		jmp	.L2
  33              	.L4:
  23:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****         buffer[i] = '\0';
GAS LISTING /tmp/ccFibjQv.s 			page 2


  34              		.loc 1 23 15 discriminator 6
  35 002f 8B45F4   		movl	-12(%rbp), %eax
  36 0032 4863D0   		movslq	%eax, %rdx
  37 0035 488B45E8 		movq	-24(%rbp), %rax
  38 0039 4801D0   		addq	%rdx, %rax
  39              		.loc 1 23 19 discriminator 6
  40 003c C60000   		movb	$0, (%rax)
  22:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****         buffer[i] = '\0';
  41              		.loc 1 22 82 discriminator 6
  42 003f 836DF401 		subl	$1, -12(%rbp)
  43              	.L2:
  22:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****         buffer[i] = '\0';
  44              		.loc 1 22 5 discriminator 1
  45 0043 837DF400 		cmpl	$0, -12(%rbp)
  46 0047 7829     		js	.L7
  22:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****         buffer[i] = '\0';
  47              		.loc 1 22 47 discriminator 3
  48 0049 8B45F4   		movl	-12(%rbp), %eax
  49 004c 4863D0   		movslq	%eax, %rdx
  50 004f 488B45E8 		movq	-24(%rbp), %rax
  51 0053 4801D0   		addq	%rdx, %rax
  52 0056 0FB600   		movzbl	(%rax), %eax
  22:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****         buffer[i] = '\0';
  53              		.loc 1 22 37 discriminator 3
  54 0059 3C0D     		cmpb	$13, %al
  55 005b 74D2     		je	.L4
  22:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****         buffer[i] = '\0';
  56              		.loc 1 22 68 discriminator 5
  57 005d 8B45F4   		movl	-12(%rbp), %eax
  58 0060 4863D0   		movslq	%eax, %rdx
  59 0063 488B45E8 		movq	-24(%rbp), %rax
  60 0067 4801D0   		addq	%rdx, %rax
  61 006a 0FB600   		movzbl	(%rax), %eax
  22:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****         buffer[i] = '\0';
  62              		.loc 1 22 59 discriminator 5
  63 006d 3C0A     		cmpb	$10, %al
  64 006f 74BE     		je	.L4
  24:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****     }
  25:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****     return;
  65              		.loc 1 25 5
  66 0071 90       		nop
  67              	.L7:
  68 0072 90       		nop
  26:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c **** }
  69              		.loc 1 26 1
  70 0073 488B45F8 		movq	-8(%rbp), %rax
  71 0077 64483304 		xorq	%fs:40, %rax
  71      25280000 
  71      00
  72 0080 7405     		je	.L6
  73 0082 E8000000 		call	__stack_chk_fail@PLT
  73      00
  74              	.L6:
  75 0087 C9       		leave
  76              	.LCFI2:
  77              		.cfi_def_cfa 7, 8
  78 0088 C3       		ret
GAS LISTING /tmp/ccFibjQv.s 			page 3


  79              		.cfi_endproc
  80              	.LFE6:
  82              		.section	.text.gets_s,"ax",@progbits
  83              		.globl	gets_s
  85              	gets_s:
  86              	.LFB7:
  27:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c **** 
  28:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c **** /*
  29:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  * <FUNCTION DESCRIPTION>
  30:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  *    The gets_s function reads at most one less than the number of characters
  31:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  *    specified by destMax from the stream pointed to by stdin, into the array pointed to by buffer
  32:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  *    The line consists of all characters up to and including
  33:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  *    the first newline character ('\n'). gets_s then replaces the newline
  34:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  *    character with a null character ('\0') before returning the line.
  35:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  *    If the first character read is the end-of-file character, a null character
  36:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  *    is stored at the beginning of buffer and NULL is returned.
  37:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  *
  38:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  * <INPUT PARAMETERS>
  39:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  *    buffer                         Storage location for input string.
  40:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  *    numberOfElements       The size of the buffer.
  41:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  *
  42:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  * <OUTPUT PARAMETERS>
  43:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  *    buffer                         is updated
  44:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  *
  45:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  * <RETURN VALUE>
  46:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  *    buffer                         Successful operation
  47:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  *    NULL                           Improper parameter or read fail
  48:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****  */
  49:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c **** char *gets_s(char *buffer, size_t numberOfElements)
  50:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c **** {
  87              		.loc 1 50 1
  88              		.cfi_startproc
  89 0000 F30F1EFA 		endbr64
  90 0004 55       		pushq	%rbp
  91              	.LCFI3:
  92              		.cfi_def_cfa_offset 16
  93              		.cfi_offset 6, -16
  94 0005 4889E5   		movq	%rsp, %rbp
  95              	.LCFI4:
  96              		.cfi_def_cfa_register 6
  97 0008 4883EC30 		subq	$48, %rsp
  98 000c 48897DD8 		movq	%rdi, -40(%rbp)
  99 0010 488975D0 		movq	%rsi, -48(%rbp)
 100              		.loc 1 50 1
 101 0014 64488B04 		movq	%fs:40, %rax
 101      25280000 
 101      00
 102 001d 488945F8 		movq	%rax, -8(%rbp)
 103 0021 31C0     		xorl	%eax, %eax
  51:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****     size_t len;
  52:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c **** #ifdef SECUREC_COMPATIBLE_WIN_FORMAT
  53:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****     size_t bufferSize = ((numberOfElements == (size_t)-1) ? SECUREC_STRING_MAX_LEN : numberOfElemen
  54:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c **** #else
  55:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****     size_t bufferSize = numberOfElements;
 104              		.loc 1 55 12
 105 0023 488B45D0 		movq	-48(%rbp), %rax
 106 0027 488945E8 		movq	%rax, -24(%rbp)
GAS LISTING /tmp/ccFibjQv.s 			page 4


  56:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c **** #endif
  57:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c **** 
  58:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****     if (buffer == NULL || bufferSize == 0 || bufferSize > SECUREC_STRING_MAX_LEN) {
 107              		.loc 1 58 8
 108 002b 48837DD8 		cmpq	$0, -40(%rbp)
 108      00
 109 0030 7412     		je	.L9
 110              		.loc 1 58 24 discriminator 1
 111 0032 48837DE8 		cmpq	$0, -24(%rbp)
 111      00
 112 0037 740B     		je	.L9
 113              		.loc 1 58 43 discriminator 2
 114 0039 B8000000 		movl	$2147483648, %eax
 114      80
 115 003e 483945E8 		cmpq	%rax, -24(%rbp)
 116 0042 7207     		jb	.L10
 117              	.L9:
  59:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****         SECUREC_ERROR_INVALID_PARAMTER("gets_s");
  60:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****         return NULL;
 118              		.loc 1 60 16
 119 0044 B8000000 		movl	$0, %eax
 119      00
 120 0049 EB5F     		jmp	.L11
 121              	.L10:
  61:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****     }
  62:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c **** 
  63:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****     if (fgets(buffer, (int)bufferSize, stdin) == NULL) {
 122              		.loc 1 63 9
 123 004b 488B1500 		movq	stdin(%rip), %rdx
 123      000000
 124 0052 488B45E8 		movq	-24(%rbp), %rax
 125 0056 89C1     		movl	%eax, %ecx
 126 0058 488B45D8 		movq	-40(%rbp), %rax
 127 005c 89CE     		movl	%ecx, %esi
 128 005e 4889C7   		movq	%rax, %rdi
 129 0061 E8000000 		call	fgets@PLT
 129      00
 130              		.loc 1 63 8
 131 0066 4885C0   		testq	%rax, %rax
 132 0069 7507     		jne	.L12
  64:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****         return NULL;
 133              		.loc 1 64 16
 134 006b B8000000 		movl	$0, %eax
 134      00
 135 0070 EB38     		jmp	.L11
 136              	.L12:
  65:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****     }
  66:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c **** 
  67:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****     len = strlen(buffer);
 137              		.loc 1 67 11
 138 0072 488B45D8 		movq	-40(%rbp), %rax
 139 0076 4889C7   		movq	%rax, %rdi
 140 0079 E8000000 		call	strlen@PLT
 140      00
 141 007e 488945F0 		movq	%rax, -16(%rbp)
  68:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****     if (len > 0 && len < bufferSize) {
 142              		.loc 1 68 8
GAS LISTING /tmp/ccFibjQv.s 			page 5


 143 0082 48837DF0 		cmpq	$0, -16(%rbp)
 143      00
 144 0087 741D     		je	.L13
 145              		.loc 1 68 17 discriminator 1
 146 0089 488B45F0 		movq	-16(%rbp), %rax
 147 008d 483B45E8 		cmpq	-24(%rbp), %rax
 148 0091 7313     		jnb	.L13
  69:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****         SecTrimCRLF(buffer, len);
 149              		.loc 1 69 9
 150 0093 488B55F0 		movq	-16(%rbp), %rdx
 151 0097 488B45D8 		movq	-40(%rbp), %rax
 152 009b 4889D6   		movq	%rdx, %rsi
 153 009e 4889C7   		movq	%rax, %rdi
 154 00a1 E8000000 		call	SecTrimCRLF
 154      00
 155              	.L13:
  70:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****     }
  71:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c **** 
  72:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c ****     return buffer;
 156              		.loc 1 72 12
 157 00a6 488B45D8 		movq	-40(%rbp), %rax
 158              	.L11:
  73:/home/xingli/share/LiteOS_Lab/secure_c/src/gets_s.c **** }
 159              		.loc 1 73 1
 160 00aa 488B4DF8 		movq	-8(%rbp), %rcx
 161 00ae 6448330C 		xorq	%fs:40, %rcx
 161      25280000 
 161      00
 162 00b7 7405     		je	.L14
 163 00b9 E8000000 		call	__stack_chk_fail@PLT
 163      00
 164              	.L14:
 165 00be C9       		leave
 166              	.LCFI5:
 167              		.cfi_def_cfa 7, 8
 168 00bf C3       		ret
 169              		.cfi_endproc
 170              	.LFE7:
 172              		.text
 173              	.Letext0:
 174              		.file 2 "/usr/lib/gcc/x86_64-linux-gnu/9/include/stddef.h"
 175              		.file 3 "/usr/include/x86_64-linux-gnu/bits/types.h"
 176              		.file 4 "/usr/include/x86_64-linux-gnu/bits/types/struct_FILE.h"
 177              		.file 5 "/usr/include/x86_64-linux-gnu/bits/types/FILE.h"
 178              		.file 6 "/usr/include/stdio.h"
 179              		.file 7 "/usr/include/x86_64-linux-gnu/bits/sys_errlist.h"
 1231              		.section	.note.gnu.property,"a"
 1232              		.align 8
 1233 0000 04000000 		.long	 1f - 0f
 1234 0004 10000000 		.long	 4f - 1f
 1235 0008 05000000 		.long	 5
 1236              	0:
 1237 000c 474E5500 		.string	 "GNU"
 1238              	1:
 1239              		.align 8
 1240 0010 020000C0 		.long	 0xc0000002
 1241 0014 04000000 		.long	 3f - 2f
GAS LISTING /tmp/ccFibjQv.s 			page 6


 1242              	2:
 1243 0018 03000000 		.long	 0x3
 1244              	3:
 1245 001c 00000000 		.align 8
 1246              	4:
GAS LISTING /tmp/ccFibjQv.s 			page 7


DEFINED SYMBOLS
                            *ABS*:0000000000000000 gets_s.c
     /tmp/ccFibjQv.s:6      .text.SecTrimCRLF:0000000000000000 SecTrimCRLF
     /tmp/ccFibjQv.s:85     .text.gets_s:0000000000000000 gets_s

UNDEFINED SYMBOLS
_GLOBAL_OFFSET_TABLE_
__stack_chk_fail
stdin
fgets
strlen
